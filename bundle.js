(()=>{"use strict";const e={apiKey:"AIzaSyD43JJNR2N3jpFVkhSJPIwX5LOYl9gvkJc",authDomain:"blog-db903.firebaseapp.com",databaseURL:"https://blog-db903-default-rtdb.firebaseio.com",projectId:"blog-db903",storageBucket:"blog-db903.appspot.com",messagingSenderId:"462047592288",appId:"1:462047592288:web:887b0e53070a0b32e92805",measurementId:"G-GMV4370K96"};class t{constructor(e){this.data=e,this.availableLanguages=Object.keys(this.data.lyrics),this.linesCount=this.data.lyrics[this.availableLanguages[0]].length}_findIndex=e=>{const t=this.data.startTime.findIndex((t=>t>e));return t>=0?t-1:this.linesCount-1};getPrevIndex=e=>{const t=this._findIndex(e);return t>=0?t-1:null};getCurrIndex=e=>{const t=this._findIndex(e);return t>=0?t:null};getNextIndex=e=>{const t=this._findIndex(e);return t<this.linesCount-1?t+1:null}}class a{constructor(e){this.repeatIndex=null,this.repeatFlag=!1,this.repeatElement=e}toggleRepeat=()=>{null!==this.repeatIndex&&(this.repeatFlag=!this.repeatFlag,this.repeatFlag?this.repeatElement.classList.add("active"):this.repeatElement.classList.remove("active"))}}const n=async e=>{var t=document.createElement("script"),a=document.getElementsByTagName("script")[0];return t.src="https://www.youtube.com/iframe_api",a.parentNode.insertBefore(t,a),new Promise((t=>{window.onYouTubeIframeAPIReady=function(){class a extends window.YT.Player{constructor(e,t){super(e,t),this.isPlayerPlaying=!1}togglePlay=()=>{this.getPlayerState()!==YT.PlayerState.PLAYING?this.playVideo():n.pauseVideo()};handleStateChange=e=>{console.log(e.data,n.isPlayerPlaying),this.isPlayerPlaying=e.data!==YT.PlayerState.PAUSED}}let n=new a("player",{videoId:e,playerVars:{rel:0},events:{onStateChange:e=>n.handleStateChange(e)}});t(n)}}))};(async()=>{const s=await(async()=>(firebase.initializeApp(e),firebase.firestore()))(),r=await(async(e,t)=>{const a=e.collection("songs");return(await a.where("name","==","7月の翼").get()).docs.map((e=>e.data()))})(s);if(0===r.length)return;console.log("Song:",r);const i=await(async()=>{const e=document.getElementById("player").dataset.video,t=await n(e);return console.log("Video ID:",e),t})();i.addEventListener("onReady",(async()=>{console.log("Player ready");const e=await(async(e,n)=>{console.log("player",e);const s=document.getElementById("lyric"),r=new t(n),i=document.getElementById("repeat"),l=new a(i),o=document.getElementById("previous"),c=document.getElementById("toggle"),d=document.getElementById("next");i.addEventListener("click",(t=>{t.preventDefault(),l.repeatIndex=r.getCurrIndex(e.getCurrentTime()),l.toggleRepeat()})),o.addEventListener("click",(t=>{t.preventDefault();const a=r.getPrevIndex(e.getCurrentTime());e.seekTo(r.data.startTime[a]),l.repeatIndex=a})),c.addEventListener("click",(t=>{t.preventDefault(),e.togglePlay()})),d.addEventListener("click",(t=>{t.preventDefault();const a=r.getNextIndex(e.getCurrentTime());e.seekTo(r.data.startTime[a]),l.repeatIndex=a}));const g=document.getElementById("state-icon"),u=s.children;let p=null;return setInterval((()=>{let t=r.getCurrIndex(e.getCurrentTime());l.repeatFlag&&l.repeatIndex!==t&&e.seekTo(r.data.startTime[l.repeatIndex]),t!==p&&Array.from(u).forEach(((e,a)=>{e.classList.toggle("active",a===t)})),p=t;const a=e.isPlayerPlaying;g.classList.toggle("fa-play",!a),g.classList.toggle("fa-pause",a)}),100),document.querySelectorAll('[data-lang="jp"]').forEach((e=>{e.style.display="none"})),Array.from(s.children).forEach(((t,a)=>{t.addEventListener("click",(()=>{e.seekTo(n.startTime[a]),e.playVideo(),l.repeatIndex=a})),t.setAttribute("data-time",n.startTime[a]);const s=Object.keys(n.lyrics).sort().reduce(((e,t)=>(e[t]=n.lyrics[t],e)),{});for(const[e,r]of Object.entries(s)){if("jp"===e&&"jp_yomi"in n.lyrics)continue;const s=document.createElement("div");s.setAttribute("data-lang",e),s.innerHTML=r[a],t.appendChild(s)}})),!0})(i,r[0]);console.log("Lyrics loaded:",e)}))})().then((()=>console.log("Initialized"))).catch((e=>console.error(e)))})();